<ion-header class="wide-header" [ngClass]="{cordova: platformProvider.isCordova}">
  <ion-navbar>
    <ion-title>
      <div [reveal-at-scroll-pos]="expandableHeader.headerHeight" [scrollArea]="scrollArea">
        {{title}}
      </div>
    </ion-title>
    <ng-content select="[right]"></ng-content>
  </ion-navbar>
</ion-header>
<ion-content #scrollArea>
  <div class="wrapper">
    <expandable-header [scrollArea]="scrollArea" [fadeFactor]="5" [disableFade]="true" #expandableHeader>
      <ion-toolbar class="wide-header__title">
        <expandable-header-primary>
          {{title}}
        </expandable-header-primary>
      </ion-toolbar>
    </expandable-header>

    <search-bar *ngIf="!category || category === 'All'" [scrollArea]="wideHeaderPage?.scrollArea"
      (search)="onSearch($event.target.value)" placeholder="{{ 'Search for a brand' | translate }}"></search-bar>

    <div *ngIf="category && category !== 'All'" class="category-divider"></div>



    <div *ngIf="!category">
      <div *ngIf="!searchQuery">
        <div *ngIf="slides">
          <div class="category-header">
            <div class="category-header__name">Recently Purchased</div>
          </div>
          <ion-slides *ngIf="slides.length > 1" spaceBetween="-40" class="curation">
            <ion-slide *ngFor="let slide of slides">
              <card-list-item *ngFor="let card of slide" (click)="buyCard(card)" [card]="card"></card-list-item>
            </ion-slide>
          </ion-slides>
          <div *ngIf="slides.length === 1">
            <card-list-item *ngFor="let card of slides[0]" (click)="buyCard(card)" [card]="card"></card-list-item>
          </div>
        </div>
        <div class="category-divider"></div>
        <div class="category-header">
          <div class="category-header__name">Just Added</div>
        </div>
        <div class="horizontal-list-wrapper">
          <div class="horizontal-list">
            <card-list-item *ngFor="let card of curatedCards" (click)="buyCard(card)" [card]="card"></card-list-item>
          </div>
        </div>
        <div class="category-divider"></div>
        <div class="category-header">
          <div class="category-header__name">Popular Brands</div>
        </div>
        <div class="horizontal-list-wrapper">
          <div class="horizontal-list">
            <card-list-item *ngFor="let card of curatedCards" (click)="buyCard(card)" [card]="card"></card-list-item>
          </div>
        </div>
        <div class="category-divider"></div>
        <div class="category-header">
          <div class="category-header__name">Categories</div>
          <div tappable class="category-header__button" (click)="viewCategory('All')">See All Brands</div>
        </div>
        <button ion-item class="category-item" (click)="viewCategory('Fashion & Apparel')">
          <ion-icon item-start> Ô∏èüë†</ion-icon>
          Fashion & Apparel
        </button>
        <button ion-item class="category-item">
          <ion-icon item-start> Ô∏èÔ∏èüëæ</ion-icon>
          Entertainment & Gaming
        </button>

        <br>
        <br>
        <br>
      </div>

      <div *ngIf="searchQuery && visibleCards.length">
        <card-list-item *ngFor="let card of visibleCards" (click)="buyCard(card)" [card]="card"></card-list-item>
      </div>
    </div>

    <!-- <div *ngIf="category"> -->
    <ion-list class="bp-list" [virtualScroll]="allCards" [approxItemHeight]="'87px'" [virtualTrackBy]="trackBy"
      [headerFn]="getHeaderFn" [hidden]="searchQuery" *ngIf="category">

      <ion-item-divider *virtualHeader="let header">
        {{ header }}
      </ion-item-divider>

      <button ion-item class="card-list-item" *virtualItem="let card" (click)="buyCard(card)">
        <ion-icon item-start>
          <img-loader class="card-list-item__icon" [src]="cardConfigMap[card.name]?.icon" [fallbackAsPlaceholder]="true"
            [fallbackUrl]="giftCardProvider.fallbackIcon"></img-loader>
        </ion-icon>
        <ion-label>

          <div *ngIf="cardConfigMap">
            <div class="card-list-item__label ellipsis">
              {{ cardConfigMap[card.name].displayName }}
            </div>
            <ion-note class="card-list-item__note ellipsis" *ngIf="!cardConfigMap[card.name].supportedAmounts">
              {{ cardConfigMap[card.name].minAmount | formatCurrency: cardConfigMap[card.name].currency:0 }} ‚Äî
              {{ cardConfigMap[card.name].maxAmount | formatCurrency: cardConfigMap[card.name].currency:0 }}
            </ion-note>
            <ion-note class="card-list-item__note ellipsis" *ngIf="cardConfigMap[card.name].supportedAmounts">
              <span *ngFor="
                    let amount of cardConfigMap[card.name].supportedAmounts;
                    let last = last
                  ">
                {{ amount | formatCurrency: cardConfigMap[card.name].currency:'minimal'
                }}<span *ngIf="!last">,</span>
              </span>
            </ion-note>
          </div>
        </ion-label>
        <ion-note item-end class="discount" *ngIf="hasVisibleDiscount(card)"><span class="discount-prefix">Save
          </span>
          <gift-card-discount-text [showConcisePercentage]="true" [cardConfig]="card" [discount]="card.discounts[0]">
          </gift-card-discount-text><span class="discount-suffix"> Off</span>
        </ion-note>
        <ion-note item-end class="discount" *ngIf="!hasVisibleDiscount(card) && hasPromotion(card)">
          Deal
        </ion-note>

      </button>

    </ion-list>
    <!-- </div> -->

    <div class="no-results" *ngIf="searchQuery && !visibleCards.length">
      <div>
        <div class="no-results__title">No Results</div>
        <div class="no-results__subtitle">Please try searching something else</div>
      </div>
    </div>


    <!-- <button ion-item class="card-list-item" *ngFor="let card of visibleCards" (click)="buyCard(card)">
      <ion-icon item-start>
        <img-loader class="card-list-item__icon" [src]="cardConfigMap[card.name]?.icon" [fallbackAsPlaceholder]="true"
          [fallbackUrl]="giftCardProvider.fallbackIcon"></img-loader>
      </ion-icon>
      <ion-label>

        <div *ngIf="cardConfigMap">
          <div class="card-list-item__label ellipsis">
            {{ cardConfigMap[card.name].displayName }}
          </div>
          <ion-note class="card-list-item__note ellipsis" *ngIf="!cardConfigMap[card.name].supportedAmounts">
            {{ cardConfigMap[card.name].minAmount | formatCurrency: cardConfigMap[card.name].currency:0 }} ‚Äî
            {{ cardConfigMap[card.name].maxAmount | formatCurrency: cardConfigMap[card.name].currency:0 }}
          </ion-note>
          <ion-note class="card-list-item__note ellipsis" *ngIf="cardConfigMap[card.name].supportedAmounts">
            <span *ngFor="
                  let amount of cardConfigMap[card.name].supportedAmounts;
                  let last = last
                ">
              {{ amount | formatCurrency: cardConfigMap[card.name].currency:'minimal'
              }}<span *ngIf="!last">,</span>
            </span>
          </ion-note>
        </div>
      </ion-label>
      <ion-note item-end class="discount" *ngIf="hasVisibleDiscount(card)"><span class="discount-prefix">Save
        </span>
        <gift-card-discount-text [showConcisePercentage]="true" [cardConfig]="card" [discount]="card.discounts[0]">
        </gift-card-discount-text><span class="discount-suffix"> Off</span>
      </ion-note>
      <ion-note item-end class="discount" *ngIf="!hasVisibleDiscount(card) && hasPromotion(card)">
        Deal
      </ion-note>

    </button> -->














    <!-- 
      <ion-list class="bp-list" [virtualScroll]="allCards" [approxItemHeight]="'87px'" [virtualTrackBy]="trackBy"
      [headerFn]="getHeaderFn" [hidden]="searchQuery">

      <ion-item-divider *virtualHeader="let header">
        {{ header }}
      </ion-item-divider>

      <button ion-item class="card-list-item" *virtualItem="let card" (click)="buyCard(card)">
        <ion-icon item-start>
          <img-loader class="card-list-item__icon" [src]="cardConfigMap[card.name]?.icon" [fallbackAsPlaceholder]="true"
            [fallbackUrl]="giftCardProvider.fallbackIcon"></img-loader>
        </ion-icon>
        <ion-label>

          <div *ngIf="cardConfigMap">
            <div class="card-list-item__label ellipsis">
              {{ cardConfigMap[card.name].displayName }}
            </div>
            <ion-note class="card-list-item__note ellipsis" *ngIf="!cardConfigMap[card.name].supportedAmounts">
              {{ cardConfigMap[card.name].minAmount | formatCurrency: cardConfigMap[card.name].currency:0 }} ‚Äî
              {{ cardConfigMap[card.name].maxAmount | formatCurrency: cardConfigMap[card.name].currency:0 }}
            </ion-note>
            <ion-note class="card-list-item__note ellipsis" *ngIf="cardConfigMap[card.name].supportedAmounts">
              <span *ngFor="
                    let amount of cardConfigMap[card.name].supportedAmounts;
                    let last = last
                  ">
                {{ amount | formatCurrency: cardConfigMap[card.name].currency:'minimal'
                }}<span *ngIf="!last">,</span>
              </span>
            </ion-note>
          </div>
        </ion-label>
        <ion-note item-end class="discount" *ngIf="hasVisibleDiscount(card)"><span class="discount-prefix">Save
          </span>
          <gift-card-discount-text [showConcisePercentage]="true" [cardConfig]="card" [discount]="card.discounts[0]">
          </gift-card-discount-text><span class="discount-suffix"> Off</span>
        </ion-note>
        <ion-note item-end class="discount" *ngIf="!hasVisibleDiscount(card) && hasPromotion(card)">
          Deal
        </ion-note>

      </button>

    </ion-list>

    <ion-list class="bp-list" [virtualScroll]="visibleCards" [approxItemHeight]="'87px'" [virtualTrackBy]="trackBy">

      <button ion-item class="card-list-item" *virtualItem="let card" (click)="buyCard(card)">
        <ion-icon item-start>
          <img-loader class="card-list-item__icon" [src]="cardConfigMap[card.name]?.icon" [fallbackAsPlaceholder]="true"
            [fallbackUrl]="giftCardProvider.fallbackIcon"></img-loader>
        </ion-icon>
        <ion-label>

          <div *ngIf="cardConfigMap">
            <div class="card-list-item__label ellipsis">
              {{ cardConfigMap[card.name].displayName }}
            </div>
            <ion-note class="card-list-item__note ellipsis" *ngIf="!cardConfigMap[card.name].supportedAmounts">
              {{ cardConfigMap[card.name].minAmount | formatCurrency: cardConfigMap[card.name].currency:0 }} ‚Äî
              {{ cardConfigMap[card.name].maxAmount | formatCurrency: cardConfigMap[card.name].currency:0 }}
            </ion-note>
            <ion-note class="card-list-item__note ellipsis" *ngIf="cardConfigMap[card.name].supportedAmounts">
              <span *ngFor="
                    let amount of cardConfigMap[card.name].supportedAmounts;
                    let last = last
                  ">
                {{ amount | formatCurrency: cardConfigMap[card.name].currency:'minimal'
                }}<span *ngIf="!last">,</span>
              </span>
            </ion-note>
          </div>
        </ion-label>
        <ion-note item-end class="discount" *ngIf="hasVisibleDiscount(card)"><span class="discount-prefix">Save
          </span>
          <gift-card-discount-text [showConcisePercentage]="true" [cardConfig]="card" [discount]="card.discounts[0]">
          </gift-card-discount-text><span class="discount-suffix"> Off</span>
        </ion-note>
        <ion-note item-end class="discount" *ngIf="!hasVisibleDiscount(card) && hasPromotion(card)">
          Deal
        </ion-note>
      </button>

    </ion-list> -->

  </div>
</ion-content>